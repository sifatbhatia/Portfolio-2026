{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/SB/Lumen/app/api/pulses/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\n\nexport const runtime = 'edge'\n\nconst SUPABASE_URL = \"https://nevuacfqoqaixtojxwve.supabase.co\";\nconst SUPABASE_KEY = process.env.SUPABASE_SERVICE_ROLE_KEY || \"sb_publishable_pWgcYZJe1jGJcpG5_vcAQw_p512x0cR\"; // Using provided key as fallback but should be in env\n\nasync function supabaseFetch(path: string, options: any = {}) {\n  const res = await fetch(`${SUPABASE_URL}/rest/v1/${path}`, {\n    ...options,\n    headers: {\n      'apikey': SUPABASE_KEY,\n      'Authorization': `Bearer ${SUPABASE_KEY}`,\n      'Content-Type': 'application/json',\n      'Prefer': 'return=representation',\n      ...options.headers,\n    },\n  });\n  return res.json();\n}\n\nexport async function GET() {\n  try {\n    const data = await supabaseFetch('pulses?select=*&order=timestamp.desc');\n    return NextResponse.json(data);\n  } catch (error) {\n    return NextResponse.json({ error: 'Failed to fetch pulses' }, { status: 500 });\n  }\n}\n\nexport async function POST(request: Request) {\n  try {\n    const body = await request.json();\n    const getRandomColor = () => `#${Math.floor(Math.random()*16777215).toString(16).padStart(6, '0')}`;\n    const atmosphere = (body.atmosphere && body.atmosphere.includes('gradient')) \n      ? body.atmosphere \n      : `linear-gradient(135deg, ${getRandomColor()} 0%, ${getRandomColor()} 100%)`;\n\n    const newPulse = {\n      title: body.title,\n      content: body.content,\n      integrity: body.integrity || 'Pure Signal',\n      resonance: body.resonance || 'Low Entropy',\n      atmosphere: atmosphere,\n      prompt: body.prompt || body.title,\n      timestamp: new Date().toISOString(),\n      slug: (body.title || 'Untitled').toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '')\n    };\n\n    const data = await supabaseFetch('pulses', {\n      method: 'POST',\n      body: JSON.stringify(newPulse),\n    });\n\n    return NextResponse.json(data[0]);\n  } catch (error) {\n    return NextResponse.json({ error: 'Invalid payload' }, { status: 400 });\n  }\n}\n\nexport async function DELETE(request: Request) {\n  const { searchParams } = new URL(request.url);\n  const slug = searchParams.get('slug');\n  if (!slug) return NextResponse.json({ error: 'Missing Slug' }, { status: 400 });\n\n  try {\n    const data = await supabaseFetch(`pulses?slug=eq.${slug}`, {\n      method: 'DELETE',\n    });\n    return NextResponse.json({ success: true, data });\n  } catch (error) {\n    return NextResponse.json({ error: 'Delete failed' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;;AAEO,MAAM,UAAU;AAEvB,MAAM,eAAe;AACrB,MAAM,eAAe,QAAQ,GAAG,CAAC,yBAAyB,IAAI,kDAAkD,sDAAsD;AAEtK,eAAe,cAAc,IAAY,EAAE,UAAe,CAAC,CAAC;IAC1D,MAAM,MAAM,MAAM,MAAM,GAAG,aAAa,SAAS,EAAE,MAAM,EAAE;QACzD,GAAG,OAAO;QACV,SAAS;YACP,UAAU;YACV,iBAAiB,CAAC,OAAO,EAAE,cAAc;YACzC,gBAAgB;YAChB,UAAU;YACV,GAAG,QAAQ,OAAO;QACpB;IACF;IACA,OAAO,IAAI,IAAI;AACjB;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,OAAO,MAAM,cAAc;QACjC,OAAO,iNAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,OAAO,iNAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAyB,GAAG;YAAE,QAAQ;QAAI;IAC9E;AACF;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,iBAAiB,IAAM,CAAC,CAAC,EAAE,KAAK,KAAK,CAAC,KAAK,MAAM,KAAG,UAAU,QAAQ,CAAC,IAAI,QAAQ,CAAC,GAAG,MAAM;QACnG,MAAM,aAAa,AAAC,KAAK,UAAU,IAAI,KAAK,UAAU,CAAC,QAAQ,CAAC,cAC5D,KAAK,UAAU,GACf,CAAC,wBAAwB,EAAE,iBAAiB,KAAK,EAAE,iBAAiB,MAAM,CAAC;QAE/E,MAAM,WAAW;YACf,OAAO,KAAK,KAAK;YACjB,SAAS,KAAK,OAAO;YACrB,WAAW,KAAK,SAAS,IAAI;YAC7B,WAAW,KAAK,SAAS,IAAI;YAC7B,YAAY;YACZ,QAAQ,KAAK,MAAM,IAAI,KAAK,KAAK;YACjC,WAAW,IAAI,OAAO,WAAW;YACjC,MAAM,CAAC,KAAK,KAAK,IAAI,UAAU,EAAE,WAAW,GAAG,OAAO,CAAC,eAAe,KAAK,OAAO,CAAC,YAAY;QACjG;QAEA,MAAM,OAAO,MAAM,cAAc,UAAU;YACzC,QAAQ;YACR,MAAM,KAAK,SAAS,CAAC;QACvB;QAEA,OAAO,iNAAY,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE;IAClC,EAAE,OAAO,OAAO;QACd,OAAO,iNAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAkB,GAAG;YAAE,QAAQ;QAAI;IACvE;AACF;AAEO,eAAe,OAAO,OAAgB;IAC3C,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;IAC5C,MAAM,OAAO,aAAa,GAAG,CAAC;IAC9B,IAAI,CAAC,MAAM,OAAO,iNAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAe,GAAG;QAAE,QAAQ;IAAI;IAE7E,IAAI;QACF,MAAM,OAAO,MAAM,cAAc,CAAC,eAAe,EAAE,MAAM,EAAE;YACzD,QAAQ;QACV;QACA,OAAO,iNAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM;QAAK;IACjD,EAAE,OAAO,OAAO;QACd,OAAO,iNAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAgB,GAAG;YAAE,QAAQ;QAAI;IACrE;AACF"}}]
}